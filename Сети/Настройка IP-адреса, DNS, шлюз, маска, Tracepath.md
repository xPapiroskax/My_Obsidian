## **IP**

Протокол _IP_ позволяет определять **местоположение конечного компьютера** в сети.

Если протокол определяет адрес конечного компьютера как адрес в том же сегменте сети (подсети), что и адрес источника, он передает пакет прямо на нужный компьютер. Если адрес назначения не принадлежит тому же сегменту, то протокол _IP_ должен использовать маршрутизаторы, чтобы переслать пакет.

В каждый пакет протокола _IP_ включается _IP_-адрес отправителя и получателя. В пакете эти адреса сохраняются на протяжении всего пути через сеть.

**IP** представляет собой ненадёжный, не требующий установления подключения протокол, который используется для адресации пакетов и их маршрутизации между компьютерами, объединёнными в сеть.

Хотя протокол _IP_ всегда пытается доставить пакет, он может быть потерян, испорчен, продублирован, доставлен вне последовательности или с опозданием. При этом протокол _IP_ не пытается исправить такие ошибки, запрашивая повторную передачу данных. Подтверждением доставки пакетов и повторной передачей потерянных занимаются протоколы более высокого уровня (например, _TCP_) или же само приложение.

Протокол _IP_ предотвращает вечное нахождение пакета в сети, ограничивая число сетей, через которые может пройти пакет. Это достигается путем назначения срока жизни _TTL_ (_Time to Live_) для каждого пакета. Параметр _TTL_ определяет максимальное время, которое пакет может провести в сети до своего удаления (максимальное число маршрутизаторов, через которые может пройти пакет).

**IP-адрес** — уникальный идентификатор, однозначно определяющий узел (хост) в сети, использующей стек протоколов _TCP/IP_.

**Узел (_node_) или хост (_host_)** — устройство, которое можно отдельно адресовать в сети, способное взаимодействовать с другими устройствами.

Чтобы протокол _IP_ мог обеспечить межсетевое взаимодействие, т. е. обеспечить обмен информацией между компьютерами, расположенными в разных подсетях большой составной сети, он должен использовать собственную глобальную систему адресации, не зависящую от адресации компьютеров в отдельных сетях.

Эта система должна позволять универсальным и однозначным способом идентифицировать любой компьютер большой составной сети.

Очевидным решением является **уникальная адресация** всех сетей составной сети, а затем адресация всех устройств в пределах каждой из этих сетей.

## **Адресация в сети**

Сетевой адрес, состоящий из номера сети и номера хоста в сети, позволит уникальным образом **идентифицировать каждый хост** в большой составной сети.

_IP_-адрес — 32-х разрядное двоичное число. Для удобства записывается в специальном формате — десятичное с точкой (_dotted decimal_) — _W.X.Y.Z_ — десятичное с точкой.

![[Pasted image 20230913090739.png]]

Для преобразования двоичного формата в десятичный посмотрим такую таблицу:
![[Pasted image 20230913090805.png]]

И для примера возьмём октет 10011001, который будет выглядеть как 128+0+0+16+8+0+0+1=153.

Для наглядности добавлю в таблицу.
![[Pasted image 20230913090830.png]]
Поэтому складываем 128+0+0+16+8+0+0+1 и получаем 153.
![[Pasted image 20230913090852.png]]

**IP-адрес** назначается не по принципу последовательного перечисления хостов, а **разбивается на две части**:

- **Идентификатор сети** (_Network ID_) — определяет физическую сеть. Он одинаков для всех узлов в одной сети и уникален для каждой сети, включённой в объединённую сеть.
- **Идентификатор хоста** (_Host ID_) — соответствует конкретному узлу (компьютеру, маршрутизатору и т.д.) в данной сети.

Идентификатор сети занимает старшую часть _IP_-адреса, идентификатор хоста — младшую. Такое представление _IP_-адреса дает возможность объединять ЛВС в большие составные сети и, наоборот, разбивать большие сети на подсети.

Запись адреса не предусматривает специальных разграничительных символов между номером сети и номером узла. Возникает необходимость при передаче пакета по сети разделять адрес на эти части.

Маршрутизация осуществляется на основании номера сети, поэтому маршрутизаторы, получая пакет, должны читать из соответствующего поля заголовка адрес назначения и выделять из него номер сети. Но для определения, какая часть выведена к номеру сети, а какая — к номеру узла, существует распределение по классам сетей.

Каждый класс сети определяет, какая часть адреса отводится под _ID_ сети, а какая — под _ID_ хоста. Различают **классы сетей**:
![[Pasted image 20230913090922.png]]
Признаком, на основании которого _IP_-адрес относится к тому или иному классу, является **значение нескольких старших бит адреса**.
![[Pasted image 20230913090942.png]]

Также за разделение хостов и сетей отвечают **маски подсети**.

![[Pasted image 20230913091009.png]]

Как узнать, какое количество бит представляет сетевую часть адреса, а какое — хостовую часть? При указании сетевого адреса _IPv4_ вы добавляете длину префикса к сетевому адресу.

**Длина префикса** — это количество бит в адресе, представляющих его сетевую часть. Например, в 172.16.55.87/16, /16 — это длина префикса. Она указывает, что первые 16 бит являются сетевым адресом. Оставшиеся 16 бит, то есть два последних октета, будут хостовой частью.

**Объект, использующийся для определения сетевыми устройствами сетевой части адреса _IPv4_, называют ***маской подсети***.

Маска подсети состоит из 32 битов, как и _IP_-адрес, и использует единицы и нули для указания, какие биты адреса являются битами сетевой части, и какие биты являются битами хостовой части. Маска подсети указывается в том же самом десятичном формате с разделением через точку, что и адрес _IPv4_. Маска подсети создается путём проставления двоичной единицы в каждый бит, представляющий сетевую часть адреса, и размещение двоичного нуля в каждый бит, представляющий хостовую часть. Префикс /16 выражается как маска подсети 255.255.0.0 (11111111.11111111. 00000000.00000000). Оставшиеся младшие биты маски подсети — нули, они указывают на адрес хоста в сети.

Маска подсети настраивается на хосте вместе с адресом _IPv4_ для определения сетевой части этого адреса.

Сети не всегда присваивается один и тот же префикс. В зависимости от числа хостов в сети, присвоенный сетям префикс может быть разным. Наличие другого префикса изменяет диапазон хостов и широковещательный адрес для каждой сети.

Например, рассмотрим хост 10.1.20.70/26.

Адрес:

- 10.1.20.70
- 00001010.00000001.00010100.01000110

Маска подсети:

- 255.255.255.192
- 11111111.11111111.11111111.11000000

Адрес сети:

- 10.1.20.64
- 00001010.00000001.00010100.01000000

А теперь, когда немного разобрались с тем, как устроены _IP_-адрес и маска подсети, то можно перейти к настройке.

## **Настройка IP-адреса**

Как говорилось в прошлом модуле, за настройку адресов отвечают утилиты `IP AD` (сокращённо от `ip address` или `ip addr` — её можно сокращать по-разному) и/или `Ifconfig`.

Стоит рассмотреть пример с утилитой `ip`. Как известно из прошлого модуля, у системы есть интерфейс, и у которого есть определённое имя. И при назначении _IP_-адреса надо указывать имя интерфейса, т.к. интерфейсов может быть несколько.

![[Pasted image 20230913091209.png]]

В этом примере добавляется _IP_-адрес 1.2.3.4 с префиксом 24 на интерфейс _ens160_. Используется команда `add` для добавления. Для удаления же нужно использовать `del`.
![[Pasted image 20230913091225.png]]

Но в данном случае после перезагрузки системы настройки не будут сохранены, поэтому настройками для сетевых интерфейсов занимается утилита `Netplan`.

Файлы конфигурации располагаются в `/etc/netplan/`, где будет находиться файл, помеченный как `yaml` после точки.

Сама структура файла будет выглядеть примерно так:
![[Pasted image 20230913091253.png]]

Где:

- Строка `network:` указывает, что начинаются настройки для сетевых интерфейсов.

- `ethernets` указывает на то, что настройки будут именно для _Ethernet_-адаптеров.
- Следующая после `ethernets` строка — это имя интерфейса, в дальнейшем то, что будет идти после, является настройками для данного интерфейса.
- `dhcp4:` no указывает на то, что не надо принимать настройки по _dhcp_. Может принимать также состояние `yes`. Аналогом могут выступать `true` и `false`. Есть и аналогичный параметр `dhcp6` — работает как `dhcp4`, но только с _IPv6_.
- В строке `addresses:` в квадратных скобках, совместно с префиксом, указывается адрес, который должен быть назначен устройству. В данном примере мы используем только один адрес, но на один интерфейс можно назначать и несколько адресов. Но это будем применять позже, когда будет работа с несколькими серверами.
- В строке `gateway4` указывается основной шлюз для сети. Обычно это первый адрес в сети.
- Далее идёт `nameservers` — конфигурация для серверов имён, где требуется указывать в квадратных скобках через запятую основной и дополнительный _DNS_-сервера.

![[Pasted image 20230913091325.png]]