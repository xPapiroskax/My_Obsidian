
**SELinux** (англ. _Security_-_Enhanced_ _Linux_ — _Linux_ с улучшенной безопасностью) — ещё одна система для улучшения безопасности в _Linux_. Работает на основе «меток контекста» в контексте (простите за тавтологию) _SELinux._ Каждому элементу в системе (файлу, порту и т.д.) присваивается определенный контекст. Далее по этому контексту _SELinux_ решает, давать запрошенный доступ или нет.

О контексте можно думать, как о браслетах в отеле: один контекст (браслет) даёт доступ только к завтракам, второй — ко всему шведскому столу, третий — ещё и лежаками позволяет пользоваться.

_SELinux_ может работать в одном из трёх режимов:

1. `enforcing` — программа активирована и блокирует все несоответствующие политикам действия;
2. `permissiv` — только фиксирует нарушения в логах;
3. `disabled` — отключена.

Конфигурационный файл хранится по пути /_etc_/_selinux_/_config_

Чтобы отключить его, надо вместо `enforcing` прописать `disabled`. После чего в командной строке прописать:

[root@localhost selinux]# setenforce 0

Для просмотра текущих настроек безопасности мы будем использовать уже знакомую вам `ls`, но с ключом `-Z`. В данный момент я нахожусь в домашней директории `root`, и там лежит один файл — _.bash_profile_.

[root@localhost ~]# ls -Z .bash_profile
system_u:object_r:admin_home_t:s0 .bash_profile

Рассмотрим, что означают все эти описания. Права имеют такой вид:

<сущность>:<роль>:<домен/тип>:<уровень:категория>

- `<сущность>` или тип пользователя — это субъект, совершающий действие. Зачастую эту роль исполняют процесс или программа. В примере эту роль играет `system_u`, система. Буква _u_, обозначает, что это пользователь.
- `<роль>` — список разрешенных операций или сочетание доменов. Роли не объединяются. В данном случае эта роль — объект.
- `<домен/тип>` — набор минимальных действий, необходимый для выполнения операции. Термин «Домен» применяется к процессам, «Тип» — к файлам и папкам. В данном случае у нас тип — это файл в домашней директории администратора.
- `<уровень:категория>` — в стандартных политиках _SELinux_ не применяется. Используется для _MLS_/_MCS_ (_Model_ _Multi_-_Level_ _Security_ / _Multi_-_Category_ _Security_), в которых используются уровни доступа для файлов определенных категорий. Например, _s0-s0:c0.c1023_ — максимально разрешенный уровень доступа.

[Здесь](http://manpages.ubuntu.com/manpages/eoan/ru/man8/semanage.8.html) есть качественный перевод утилиты _semanage_ для _Ubuntu,_ но он подходит и для _CentOS,_ так как все это дистрибутивы семейства _Linux_ и для них многое совпадает.

Давайте на примере посмотрим, как сменить контекст для порта (сменим порт для _ssh_ с 22 по умолчанию на 227).

В первую очередь нужно установить дополнительный пакет, чтобы появилась команда `semanage`.

[root@localhost ~]# yum install policycoreutils-python-utils -y

И теперь мы можем посмотреть список открытых портов для _SElinux_ с помощью команды `semanage port -l`. Там будет предложено огромное количество портов, а нам нужен только _ssh_, поэтому:

[root@localhost ~]# semanage port -l |grep ssh
ssh_port_t                     tcp      22

Добавим порту 227 такой же контекст:

[root@localhost ~]# sudo semanage port -a -t ssh_port_t -p tcp 227

Смотрим результат:

[root@localhost ~]# semanage port -l |grep ssh
ssh_port_t                     tcp      227, 22

Разберём команду.

`Semanage port` указывает на то, что мы начинаем управлять портом. Кстати, с полным списком команд для внесения изменений можно ознакомиться с помощью ключа `-h` (подробнее значения ключей можно посмотреть [тут](https://www.opennet.ru/man.shtml?topic=semanage&category=8&russian=0)). С помощью ключа `-а` мы добавляем этот тип (для чего указываем ключ `-t`) и говорим, что для `ssh_port_t` правильным портом теперь будет `_TCP_-`порт (ключ `-p`) 227. Соответственно, заменив `-а` на `-d`, мы удалим порт, который укажем. Но порт 22 удалить будет не так просто, потому что он защищён политикой.

[root@localhost ~]# sudo semanage port -d -t ssh_port_t -p tcp 22
ValueError: Port tcp/22 is defined in policy, cannot be deleted

Какие функции выполняет _SELinux_?
_SELinux_ — это ещё одна система безопасности, которая может помочь вам улучшить защищенность администрируемых вами серверов.