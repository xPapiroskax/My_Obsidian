
## **Веб-сервер**

**Веб-сервер** — это программа, которая позволяет получать доступ к данным по протоколам _HTTP_, _HTTPS_ и другим. Говоря человеческим языком, это программа, которая показывает нам сайты.

Веб-сервер просто берёт информацию из папки или из результата работы программы — и отдаёт пользователю в ответ на его запрос.

Если вы не помните, то сами по себе протоколы _HTTP_ и _HTTPS_ работают на 80 и 443 портах соответственно — это, как правило, и есть те порты, на которых слушает веб-сервер. Но бывают и исключения, мы о них подробнее поговорим, когда будем настраивать веб-сервера в своих лабораторных.

## **Популярные веб-сервера**

Сейчас в мире **три самых популярных веб-сервера — это _nginx_, _Apache_ и _IIS_**.

- [Nginx](https://nginx.org/ru/) — самый популярный веб-сервер на данный момент. Читается англоязычными людьми как «эн-джен-икс», русскими как «энджинкс». Он был создан совсем недавно, в 2002 году, разработчиком [Игорем Сысоевым](https://ru.wikipedia.org/wiki/%D0%A1%D1%8B%D1%81%D0%BE%D0%B5%D0%B2,_%D0%98%D0%B3%D0%BE%D1%80%D1%8C_%D0%92%D0%BB%D0%B0%D0%B4%D0%B8%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B8%D1%87_(%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%81%D1%82)). Да, самый популярный веб-сервер в мире написан русским разработчиком. Это ли не повод для гордости?
- [Apache](https://httpd.apache.org/) — второй по популярности, первым быть перестал совсем недавно: _nginx_ его обогнал. Год его создания — 1995. Читается в англоязычном варианте как «апачи», в русском — как «апач».

_Nginx_ здорово работает со статическим контентом и может быть обратным прокси. _Apache_ — умеет тонко настраивать доступ к папкам при помощи файлов ._htaccess_. Ещё _Apache_ всё пытается сделать сам, что может, а _nginx_ считает, что он исключительно веб-сервер, и всё, что к веб-серверу не относится — пусть что-нибудь внешнее обрабатывает (такова цена его скорости и лёгкости).

## **Путь пакета**

Мы с вами уже знаем, как устроена сеть, как по ней передаются запросы, как работает модель _TCP/IP._

А теперь разберёмся, что произошло за те доли секунды, пока картинка ещё не открылась.

1. Сначала ваш **браузер** обработал адрес. Увидел, что в нём доменное имя.

2. **Браузер** сходил к **DNS-серверу**, запросил, какой _IP_-адрес у этого доменного имени.

3. **DNS-сервер** проверил свои записи и сказал **браузеру**, что нужный _IP_-адрес — 151.236.81.157.

4. **Браузер** сказал **транспортному уровню**, что хочет послать запрос «post_img/2016/10/09/11/1476042642199571781.jpg» на адрес 151.236.81.157 по протоколу _HTTPS_.

5. **Транспортный уровень** знает, что протокол _HTTPS_ — это порт 443, поэтому он сказал **сетевому уровню**, что хочет послать запрос «post_img/2016/10/09/11/1476042642199571781.jpg» на адрес 151.236.81.157 на порт 443.

6. **Сетевой уровень** знает, что 151.236.81.157 — это внешний адрес не из его сети. Поэтому он сказал **физическому уровню**, что надо пойти к шлюзу своей сети и попросить отправить пакет с запросом «post_img/2016/10/09/11/1476042642199571781.jpg” на адрес 151.236.81.157 на порт 443.

7. **Физический уровень** знает, по какому _MAC_-адресу находится **шлюз** сети. Поэтому он отправил на него пакет с запросом «post_img/2016/10/09/11/1476042642199571781.jpg» на адрес 151.236.81.157 на порт 443.

8. **Шлюз** сети взял весь этот огромный многослойный пакет, проверил, что адрес получателя 151.236.81.157 и отправил его на **следующий шлюз** по маршруту.

9. По цепочке **шлюзов**, **свичей** и **роутеров** пакет добрался до **сервера 151.236.81.157**.

10. **Межсетевой экран** на сервере 151.236.81.157 проверил, что на 443 порт разрешены запросы и пропустил пакет. Физический уровень уже отработал — пакет доставлен.

11**. Сетевой уровень сервера** запоминает _IP_-адрес отправителя (то есть ваш) и передаёт пакет **транспортному уровню сервера**.

12. **Транспортный уровень сервера** запоминает порт источника (какой-нибудь странный вроде 54209, он нужен только для того, чтобы на каждый запрос прислать именно нужный пакет), и смотрит на порт назначения. Он 443, а транспортный уровень знает, что порт 443 слушает веб-сервер и передает этот пакет **веб-серверу**.

13. **Веб-сервер** смотрит на запрос «post_img/2016/10/09/11/1476042642199571781.jpg» на адрес 151.236.81.157 на порт 443 и проверяет: на 151.236.81.157 с адресом cs8.pikabu.ru у него есть локация (то есть сайт), и у этого сайта есть место post_img/2016/10/09/11/ (скорее всего, прямо физические папки в директории сайта), а в нем действительно лежит файл 1476042642199571781.jpg и вам никак не запрещено на него смотреть.

14. **Веб-сервер** берет этот файл 1476042642199571781.jpg и передает **транспортному уровню сервера**, чтобы вернуть вам по вашему адресу по порту 54209.

15. Дальше все идёт в обратном порядке, пакет возвращается к вам (на самом деле, много пакетов), их получает **браузер**.

16. **Браузер** собирает все пакеты вместе и показывает вам картинку с котиком.

И всё это за доли секунды. А когда-то ведь ставил открываться картинку, и можно было идти кофе варить, как раз загрузится. Если, конечно, модемное соединение не оборвётся.